let Blog,cloudinary;_d7b‍.x([["createBlog",()=>createBlog],["uploadImage",()=>uploadImage],["blogsByUser",()=>blogsByUser],["blogPost",()=>blogPost],["updateBlog",()=>updateBlog],["deleteBlog",()=>deleteBlog]]);_d7b‍.w("../models/blog",[["default",["Blog"],function(v){Blog=v}]]);_d7b‍.w("cloudinary",[["default",["cloudinary"],function(v){cloudinary=v}]]);


cloudinary.config({
    cloud_name: process.env.CLOUDINARY_NAME,
    api_key: process.env.CLOUDINARY_KEY,
    api_secret: process.env.CLOUDINARY_SECRET,

});

       const createBlog = async (req,res) =>{
    _d7b‍.g.console.log("post =>", req.body);
    _d7b‍.g.console.log(req);
   const {content, image} = req.body;
   if(!content.length)
   {
       return res.json({
           error: "Content is required",
       });
    }
   try{
     
    const blog = new Blog({content, image, postedBy: req.auth._id});
    blog.save();
    res.json(blog);
   }catch(err){
       _d7b‍.g.console.log(err);
       res.sendStatus(400);
   }
};

       const uploadImage = async(req,res) => {
   // console.log("req files => ", req.files);
   try{
    const result = await cloudinary.uploader.upload(req.files.image.path);
    //console.log("Uploaded image ur =>", result);
    res.json({
        url: result.secure_url, //https url
        public_id: result.public_id,
    });
   }catch(err){
       _d7b‍.g.console.log(err);
   }
};

       const blogsByUser = async(req,res) => {
    try{
     // const posts = await Post.find({postedBy: req.auth._id}).populate('postedBy','_id fname image').sort({createdAt: -1 }).limit(10);
     // console.log("posts",posts)
     const blogs = await Blog.find().populate('postedBy','_id fname image').sort({createdAt: -1 }).limit(10);
     res.json(blogs);
    }catch(err){
        _d7b‍.g.console.log(err);
    }
};


       const blogPost = async (req, res) => {
    try {
      const blog = await Blog.findById(req.params._id);
      res.json(blog);
    } catch (err) {
      _d7b‍.g.console.log(err);
    }
  };


         const updateBlog = async (req,res) => {
     // console.log("Post update controller =>" , req.body);
     try{
        const blog = await Blog.findByIdAndUpdate(req.params._id, req.body, {
            new: true,
        });
        res.json(blog);
     }catch(err)
     {
         _d7b‍.g.console.log(err)
     }
  };
         const deleteBlog = async (req,res) => {
    // console.log("Post update controller =>" , req.body);
    try{
       const blog = await Blog.findByIdAndDelete(req.params._id);
       //remove image from cloudinary
       if(blog.image && blog.image.public_id){
           const image = await cloudinary.uploader.destroy(blog.image.public_id);
       }
       res.json({ok: true});
    }catch(err)
    {
        _d7b‍.g.console.log(err)
    }
 };